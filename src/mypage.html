--- 
layout: base
---
<div id="login_main">
    <h1 id="login_header">Login</h1>
    <p><span class="pink_text">이용자 비밀번호 5회 연속 오류시</span><br>
        이용자 아이디/비밀번호 로그인 이용이 제한됩니다.
    </p>
    <div id="login_error_msg_holder">
        <p id="login_error_msg">잘못된 아이디 또는<span id="error_msg_second_line">패스워드 입력입니다.</span></p>
    </div>
    <form id="login_form">
        <input type="text" name="username" id="username_field" class="login_form_field" placeholder="아이디 입력">
        <input type="password" name="password" id="password_field" class="login_form_field" placeholder="비밀번호 입력">
        <br>
        <input type="submit" value="로그인" id="login_form_submit">
    </form>
</div>

<script>
const loginForm = document.getElementById("login_form");
const loginButton = document.getElementById("login_form_submit");
const loginErrorMsg = document.getElementById("login_error_msg");
const errorSecondLine = document.getElementById("error_msg_second_line");

let errorCount = 0; // 비밀번호 오류 횟수를 저장할 변수

loginButton.addEventListener("click", (event) => {
    event.preventDefault();
    const username = loginForm.username.value;
    const password = loginForm.password.value;

    if (validateLoginForm(username, password)) {
        // JSON 파일 로드
        fetch("json/users.json")
        .then((response) => response.json())
        .then((data) => {
            const users = data.users;
            const user = users.find((user) => user.username === username && user.password === password);

            if (user) {
            // 로그인 성공
            alert("로그인 성공");
            location.reload();
            } else {
            // 잘못된 아이디 또는 비밀번호 입력
            errorCount++;
            if (errorCount === 5) {
                // 5회 연속 오류 시 접근 차단
                displayErrorMessage("접근이 차단되었습니다.");
                loginButton.disabled = true; // 로그인 버튼 비활성화
            } else {
                // 오류 메시지 표시
                displayErrorMessage("잘못된 아이디 또는 비밀번호 입력입니다.");
                errorSecondLine.innerText = "패스워드 입력입니다. (오류 횟수: " + errorCount + ")";
            }
            }
        })
        .catch((error) => {
            console.error("JSON 파일을 로드하는 중 오류가 발생했습니다.", error);
            displayErrorMessage("로그인에 실패했습니다. 나중에 다시 시도해주세요.");
        });
    } else {
        displayErrorMessage("아이디와 비밀번호를 모두 입력해주세요.");
    }
    });

function displayErrorMessage(message) {
loginErrorMsg.innerText = message;
loginErrorMsg.style.opacity = 1;
}

function validateLoginForm(username, password) {
return username.trim() !== "" && password.trim() !== "";
}

function isUsernameValid(username) {
const regex = /^[a-zA-Z0-9]+$/;
return regex.test(username);
}
</script>